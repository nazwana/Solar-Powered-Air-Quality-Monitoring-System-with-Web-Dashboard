<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Pemantauan Kualitas Udara | Desa Mojolebak</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="app-container">
        <header class="app-header">
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-wind"></i>
                    <h1>Sistem Pemantauan Kualitas Udara<span> Desa Mojolebak, Mojokerto</span></h1>
                </div>
                <div class="last-update">
                    <span id="lastUpdateTime">Terakhir Update: -</span>
                    <div class="status-indicator" id="connectionStatus"></div>
                </div>
                <!-- Database Selector Added Here -->
                <div class="database-selector">
                    <label for="databaseSource"><i class="fas fa-database"></i> Tempat:</label>
                    <select id="databaseSource">
                        <option value="kkn">Balai Desa</option>
                        <option value="ppk">SDN Mojolebak</option>
                    </select>
                </div>
            </div>
            <nav class="tabs">
                <ul>
                    <li class="active" data-tab="dashboard"><i class="fas fa-home"></i> Dashboard</li>
                    <li data-tab="charts"><i class="fas fa-chart-line"></i> Grafik Data</li>
                    <li data-tab="map"><i class="fas fa-map-marked-alt"></i> Peta Sensor</li>
                    <li data-tab="about"><i class="fas fa-info-circle"></i> Tentang Kami</li>
                </ul>
            </nav>
        </header>

        <main class="app-main">
            <!-- Dashboard Tab -->
            <div class="tab-content active" id="dashboard">
                <div class="air-status-card">
                    <h2><i class="fas fa-cloud"></i> Status Kualitas Udara Saat Ini</h2>
                    <div class="status-container">
                        <div class="overall-status" id="overallStatus">
                            <div class="status-circle">
                                <i class="fas fa-question"></i>
                                <span>Memuat...</span>
                            </div>
                            <div class="status-message">
                                <h3>Sedang memeriksa data...</h3>
                                <p>Harap tunggu sebentar</p>
                            </div>
                        </div>
                        <div class="action-recommendation" id="actionRecommendation">
                            <h3><i class="fas fa-lightbulb"></i> Rekomendasi Tindakan</h3>
                            <p>Menunggu data kualitas udara...</p>
                        </div>
                    </div>
                </div>

                <div class="alert-notification" id="alertNotification">
                    <div class="alert-icon">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <div class="alert-content">
                        <h3>Peringatan Kualitas Udara!</h3>
                        <p id="alertMessage">Tidak ada peringatan saat ini</p>
                    </div>
                    <button class="alert-close" id="closeAlert">&times;</button>
                </div>

                <div class="sensor-grid">
                    <!-- Temperature Card -->
                    <div class="sensor-card temperature">
                        <div class="card-header">
                            <i class="fas fa-thermometer-half"></i>
                            <h3>Suhu Udara</h3>
                        </div>
                        <div class="card-body">
                            <div class="sensor-value" id="temperatureValue">-</div>
                            <div class="sensor-unit">°C</div>
                        </div>
                        <div class="card-footer">
                            <span class="sensor-status" id="temperatureStatus">-</span>
                            <span class="sensor-time" id="temperatureTime">-</span>
                        </div>
                    </div>

                    <!-- Humidity Card -->
                    <div class="sensor-card humidity">
                        <div class="card-header">
                            <i class="fas fa-tint"></i>
                            <h3>Kelembapan</h3>
                        </div>
                        <div class="card-body">
                            <div class="sensor-value" id="humidityValue">-</div>
                            <div class="sensor-unit">%</div>
                        </div>
                        <div class="card-footer">
                            <span class="sensor-status" id="humidityStatus">-</span>
                            <span class="sensor-time" id="humidityTime">-</span>
                        </div>
                    </div>

                    <!-- CO2 Card -->
                    <div class="sensor-card co2">
                        <div class="card-header">
                            <i class="fas fa-smog"></i>
                            <h3>Karbon Dioksida (CO₂)</h3>
                        </div>
                        <div class="card-body">
                            <div class="sensor-value" id="co2Value">-</div>
                            <div class="sensor-unit">ppm</div>
                        </div>
                        <div class="card-footer">
                            <span class="sensor-status" id="co2Status">-</span>
                            <span class="sensor-time" id="co2Time">-</span>
                        </div>
                    </div>

                    <!-- H2S Card -->
                    <div class="sensor-card hazardous">
                        <div class="card-header">
                            <i class="fas fa-skull-crossbones"></i>
                            <h3>Hidrogen Sulfida (H₂S)</h3>
                        </div>
                        <div class="card-body">
                            <div class="sensor-value" id="h2sValue">-</div>
                            <div class="sensor-unit">ppm</div>
                        </div>
                        <div class="card-footer">
                            <span class="sensor-status" id="h2sStatus">-</span>
                            <span class="sensor-time" id="h2sTime">-</span>
                        </div>
                    </div>

                    <!-- NH3 Card -->
                    <div class="sensor-card hazardous">
                        <div class="card-header">
                            <i class="fas fa-skull-crossbones"></i>
                            <h3>Amonia (NH₃)</h3>
                        </div>
                        <div class="card-body">
                            <div class="sensor-value" id="nh3Value">-</div>
                            <div class="sensor-unit">ppm</div>
                        </div>
                        <div class="card-footer">
                            <span class="sensor-status" id="nh3Status">-</span>
                            <span class="sensor-time" id="nh3Time">-</span>
                        </div>
                    </div>

                    <!-- CO Card -->
                    <div class="sensor-card hazardous">
                        <div class="card-header">
                            <i class="fas fa-skull-crossbones"></i>
                            <h3>Karbon Monoksida (CO)</h3>
                        </div>
                        <div class="card-body">
                            <div class="sensor-value" id="coValue">-</div>
                            <div class="sensor-unit">ppm</div>
                        </div>
                        <div class="card-footer">
                            <span class="sensor-status" id="coStatus">-</span>
                            <span class="sensor-time" id="coTime">-</span>
                        </div>
                    </div>

                    <!-- NO2 Card -->
                    <div class="sensor-card hazardous">
                        <div class="card-header">
                            <i class="fas fa-skull-crossbones"></i>
                            <h3>Nitrogen Dioksida (NO₂)</h3>
                        </div>
                        <div class="card-body">
                            <div class="sensor-value" id="no2Value">-</div>
                            <div class="sensor-unit">ppm</div>
                        </div>
                        <div class="card-footer">
                            <span class="sensor-status" id="no2Status">-</span>
                            <span class="sensor-time" id="no2Time">-</span>
                        </div>
                    </div>

                    <!-- PM1.0 Card -->
                    <div class="sensor-card pm">
                        <div class="card-header">
                            <i class="fas fa-cloud"></i>
                            <h3>Partikulat (PM1.0)</h3>
                        </div>
                        <div class="card-body">
                            <div class="sensor-value" id="pm1Value">-</div>
                            <div class="sensor-unit">µg/m³</div>
                        </div>
                        <div class="card-footer">
                            <span class="sensor-status" id="pm1Status">-</span>
                            <span class="sensor-time" id="pm1Time">-</span>
                        </div>
                    </div>

                    <!-- PM2.5 Card -->
                    <div class="sensor-card pm">
                        <div class="card-header">
                            <i class="fas fa-cloud"></i>
                            <h3>Partikulat (PM2.5)</h3>
                        </div>
                        <div class="card-body">
                            <div class="sensor-value" id="pm25Value">-</div>
                            <div class="sensor-unit">µg/m³</div>
                        </div>
                        <div class="card-footer">
                            <span class="sensor-status" id="pm25Status">-</span>
                            <span class="sensor-time" id="pm25Time">-</span>
                        </div>
                    </div>

                    <!-- PM10 Card -->
                    <div class="sensor-card pm">
                        <div class="card-header">
                            <i class="fas fa-cloud"></i>
                            <h3>Partikulat (PM10)</h3>
                        </div>
                        <div class="card-body">
                            <div class="sensor-value" id="pm10Value">-</div>
                            <div class="sensor-unit">µg/m³</div>
                        </div>
                        <div class="card-footer">
                            <span class="sensor-status" id="pm10Status">-</span>
                            <span class="sensor-time" id="pm10Time">-</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Charts Tab -->
            <div class="tab-content" id="charts">
                <div class="chart-controls">
                    <div class="control-group">
                        <label for="parameterSelect"><i class="fas fa-filter"></i> Parameter:</label>
                        <select id="parameterSelect">
                            <option value="all">Semua Parameter</option>
                            <option value="temperature">Suhu (°C)</option>
                            <option value="humidity">Kelembapan (%)</option>
                            <option value="co2">CO₂ (ppm)</option>
                            <option value="h2s">H₂S (ppm)</option>
                            <option value="nh3">NH₃ (ppm)</option>
                            <option value="co">CO (ppm)</option>
                            <option value="no2">NO₂ (ppm)</option>
                            <option value="pm1">PM1.0 (µg/m³)</option>
                            <option value="pm25">PM2.5 (µg/m³)</option>
                            <option value="pm10">PM10 (µg/m³)</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <label for="timeRangeSelect"><i class="fas fa-calendar-alt"></i> Rentang Waktu:</label>
                        <select id="timeRangeSelect">
                            <option value="1h">1 Jam Terakhir</option>
                            <option value="6h">6 Jam Terakhir</option>
                            <option value="12h">12 Jam Terakhir</option>
                            <option value="24h">24 Jam Terakhir</option>
                            <option value="3d">3 Hari Terakhir</option>
                            <option value="7d">7 Hari Terakhir</option>
                            <option value="14d">14 Hari Terakhir</option>
                            <option value="30d">30 Hari Terakhir</option>
                            <option value="custom">Custom</option>
                        </select>
                    </div>
                    <div class="control-group custom-range" id="customRangeControls" style="display: none;">
                        <label for="startDate"><i class="fas fa-calendar"></i> Dari:</label>
                        <input type="datetime-local" id="startDate">
                        <label for="endDate"><i class="fas fa-calendar"></i> Sampai:</label>
                        <input type="datetime-local" id="endDate">
                        <button id="applyCustomRange">Terapkan</button>
                    </div>
                    <div class="control-group">
                        <button id="downloadData" class="download-btn">
                            <i class="fas fa-download"></i> Unduh Data
                        </button>
                    </div>
                </div>

                <div class="chart-container">
                    <canvas id="mainChart"></canvas>
                </div>

                <div class="data-table-container">
                    <h3><i class="fas fa-table"></i> Tabel Data Historis</h3>
                    <div class="table-wrapper">
                        <table id="historyTable">
                            <thead>
                                <tr>
                                    <th>Waktu</th>
                                    <th>Suhu (°C)</th>
                                    <th>Kelembapan (%)</th>
                                    <th>CO₂ (ppm)</th>
                                    <th>H₂S (ppm)</th>
                                    <th>NH₃ (ppm)</th>
                                    <th>CO (ppm)</th>
                                    <th>NO₂ (ppm)</th>
                                    <th>PM1.0 (µg/m³)</th>
                                    <th>PM2.5 (µg/m³)</th>
                                    <th>PM10 (µg/m³)</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Data will be inserted here by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Map Tab -->
            <div class="tab-content" id="map">
                <div class="map-container">
                    <h2><i class="fas fa-map-marked-alt"></i> Lokasi Sensor Kualitas Udara</h2>
                    <div id="sensorMap"></div>
                    <div class="map-info">
                        <div class="info-card">
                            <h3>Informasi Lokasi</h3>
                            <p><strong>Alamat:</strong> Desa Mojolebak, Kecamatan Jetis, Kabupaten Mojokerto, Jawa Timur</p>
                            <p><strong>Koordinat:</strong> -7.40169, 112.45459 (Balai Desa Mojolebak) & -7.40193, 112.45805 (SDN Mojolebak)</p>
                            <p><strong>Tanggal Pemasangan:</strong> 10 Agustus 2025</p>
                            <p><strong>Status:</strong> <span class="status-active">Aktif</span></p>
                        </div>
                        <div class="weather-card">
                            <h3>Kondisi Cuaca Sekarang</h3>
                            <div class="weather-info">
                                <div class="weather-icon">
                                    <i class="fas fa-sun"></i>
                                </div>
                                <div class="weather-details">
                                    <p><strong>Suhu:</strong> <span id="weatherTemp">-</span> °C</p>
                                    <p><strong>Kelembapan:</strong> <span id="weatherHumidity">-</span> %</p>
                                    <p><strong>Angin:</strong> <span id="weatherWind">-</span> km/jam</p>
                                    <p><strong>Kondisi:</strong> <span id="weatherCondition">-</span></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- About Tab -->
            <div class="tab-content" id="about">
                <div class="about-container">
                    <div class="about-header">
                        <h2><i class="fas fa-info-circle"></i> Tentang Sistem Pemantauan Kualitas Udara</h2>
                        <p>Sistem ini dikembangkan sebagai bagian dari program KKN-PM Institut Teknologi Sepuluh Nopember untuk memantau kualitas udara di Desa Mojolebak.</p>
                    </div>

                    <div class="about-content">
                        <div class="about-card mission">
                            <h3><i class="fas fa-bullseye"></i> Misi Kami</h3>
                            <p>Menyediakan data kualitas udara yang akurat dan real-time kepada masyarakat Desa Mojolebak untuk meningkatkan kesadaran akan pentingnya udara bersih dan mendukung advokasi lingkungan berbasis data.</p>
                        </div>

                        <div class="about-card team">
                            <h3><i class="fas fa-users"></i> Tim Pengembang</h3>
                            <div class="team-members">
                                <div class="member">
                                    <div class="member-avatar">
                                        <i class="fas fa-user"></i>
                                    </div>
                                    <div class="member-info">
                                        <h4>Divisi Technical KKN-PM</h4>
                                        <p>Departemen Teknik Instrumentasi</p>
                                        <p>Institut Teknologi Sepuluh Nopember</p>
                                    </div>
                                </div>
                                <div class="member">
                                    <div class="member-avatar">
                                        <i class="fas fa-user"></i>
                                    </div>
                                    <div class="member-info">
                                        <h4>Divisi Technical PPK-ORMAWA</h4>
                                        <p>Departemen Teknik Instrumentasi</p>
                                        <p>Institut Teknologi Sepuluh Nopember</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="about-card partners">
                            <h3><i class="fas fa-handshake"></i> Mitra Kolaborasi</h3>
                            <div class="partner-logos">
                                <div class="partner-logo">
                                    <i class="fas fa-university"></i>
                                    <p>Institut Teknologi Sepuluh Nopember</p>
                                </div>
                                <div class="partner-logo">
                                    <i class="fas fa-home"></i>
                                    <p>Pemerintah Desa Mojolebak</p>
                                </div>
                                <div class="partner-logo">
                                    <i class="fas fa-school"></i>
                                    <p>SD Negeri Mojolebak</p>
                                </div>
                            </div>
                        </div>

                        <div class="about-card contact">
                            <h3><i class="fas fa-envelope"></i> Kontak Kami</h3>
                            <p>Untuk pertanyaan lebih lanjut tentang sistem ini, silakan hubungi:</p>
                            <ul>
                                <li><i class="fas fa-envelope"></i> Email: airquality010@gmail.com</li>
                                <li><i class="fas fa-phone"></i> Telepon: 0821-3692-6004</li>
                                <li><i class="fas fa-map-marker-alt"></i> Alamat: Kampus Sukolilo, Jl. Raya ITS, Sukolilo, Surabaya 60111</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <footer class="app-footer">
            <div class="footer-content">
                <div class="footer-left">
                    <p>&copy; 2025 KKN-PM ITS Desa Mojolebak. Semua hak dilindungi.</p>
                </div>
                <div class="footer-right">
                    <p></p>
                </div>
            </div>
        </footer>
    </div>

    <!-- JavaScript Libraries -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="script.js"></script>
</body>
</html>